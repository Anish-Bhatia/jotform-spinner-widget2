<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Spinner Table Widget</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    input[type="number"] {
      width: 60px;
      text-align: center;
    }
  </style>
</head>
<body>
  <table id="spinnerTable"></table>

  <!-- Required scripts for JotForm widget -->
  <script src="https://cdn.jotfor.ms/js/widgetResizer.js"></script>
  <script src="https://cdn.jotfor.ms/JotFormCustomWidget.js"></script>
  <script>
    // Returns the table data as a 2D array (each cell's value)
    function getTableData() {
      const table = document.getElementById('spinnerTable');
      const values = [];
      for (let i = 0; i < table.rows.length; i++) {
        const rowData = [];
        for (let j = 0; j < table.rows[i].cells.length; j++) {
          const input = table.rows[i].cells[j].querySelector('input');
          rowData.push(input.value);
        }
        values.push(rowData);
      }
      return values;
    }

    // Sends the current table data to JotForm (if available)
    function updateFormData() {
      const values = getTableData();
      if (window.JFCustomWidget && JFCustomWidget.sendData) {
        JFCustomWidget.sendData({ value: JSON.stringify(values) });
      }
    }

    // Creates the spinner table based on the given rows and columns
    function createSpinnerTable(rows, cols) {
      const table = document.getElementById('spinnerTable');
      table.innerHTML = ''; // Clear any existing content

      for (let i = 0; i < rows; i++) {
        const tr = table.insertRow();
        for (let j = 0; j < cols; j++) {
          const td = tr.insertCell();
          const input = document.createElement('input');
          input.type = 'number';
          input.step = 1;      // Increment or decrement by 1
          input.value = 0;     // Default value
          // Optional: set input.min and input.max if desired
          input.addEventListener('change', updateFormData);
          td.appendChild(input);
        }
      }
      // Immediately update JotForm with the initial table data
      updateFormData();
    }

    // Check if we are running inside the JotForm widget environment
    if (window.JFCustomWidget) {
      // Subscribe to the properties event (which provides rows and cols)
      JFCustomWidget.subscribe('properties', function(props) {
        const rows = parseInt(props.rows, 10) || 6;  // default: 6 rows
        const cols = parseInt(props.cols, 10) || 2;   // default: 2 columns (two spinners side by side)
        createSpinnerTable(rows, cols);
      });

      // When the form is submitted, send the final table data
      JFCustomWidget.subscribe('submit', function() {
        const values = getTableData();
        JFCustomWidget.sendSubmit({ value: JSON.stringify(values) });
      });
    } else {
      // For local testing (or if not running in JotForm), use default values.
      window.onload = function() {
        createSpinnerTable(6, 2);
      };
    }
  </script>
</body>
</html>
